"use strict";(self["webpackChunkmohobby"]=self["webpackChunkmohobby"]||[]).push([[7942],{97942:function(t,e,o){o.r(e),o.d(e,{default:function(){return p}});var s=o(43423),r=o(11154),i=o(44363),n=o(60266),a=o(65495),c=o(11713),l=o(17808),d=function(){var t=this,e=t._self._c;return e("div",{ref:"scroll",staticClass:"scroll",attrs:{id:"container"}},[e("h1",{attrs:{id:"chat-user"}},[t._v(" "+t._s(this.$store.state.user.nickName)+" 님의 채팅방입니다 ")]),e("div",{staticClass:"room"},[e(n.Z,{staticClass:"flex-grow-1 flex-shrink-0",staticStyle:{"border-right":"1px solid",cursor:"pointer"},attrs:{cols:"12",sm:"3"}},[t._l(t.roomList,(function(i,n){return[0==i.checkIn?e("div",{staticClass:"chat-room-list",staticStyle:{"background-color":"#ffff"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.openRoom(i.roomNo)}}},[e(s.Z,[i.roomNo>1e4?e(a.Z,{attrs:{src:o(6935)(`./${i.profileImg}`),height:"100px",width:"50px","border-radius:10px":""}}):e(a.Z,{attrs:{src:o(64913)(`./${i.profileImg}`),height:"100px",width:"50px","border-radius:10px":""}})],1),e("div",{staticClass:"chat-room-list-content"},[e("v-text",{attrs:{id:"chat-nickname"}},[t._v(" "+t._s(i.nickName)+" ")]),e("v-text",[t._v(" "+t._s(i.content)+" ")])],1),0!=i.nonReadChat?e(r.Z,{staticStyle:{float:"right"},attrs:{"offset-x":"10","offset-y":"10",color:"red",content:i.nonReadChat}}):t._e()],1):e("div",{staticClass:"chat-room-list",staticStyle:{"background-color":"#bdbdbd"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.openRoom(i.roomNo)}}},[e(s.Z,[i.roomNo>1e4?e(a.Z,{attrs:{src:o(6935)(`./${i.profileImg}`),height:"100px",width:"50px","border-radius:10px":""}}):e(a.Z,{attrs:{src:o(64913)(`./${i.profileImg}`),height:"100px",width:"50px","border-radius:10px":""}})],1),e("div",{staticClass:"chat-room-list-content"},[e("v-text",{attrs:{id:"chat-nickname"}},[t._v(" "+t._s(i.nickName)+" ")]),e("v-text",[t._v(" "+t._s(i.content)+" ")])],1)],1),e("hr")]}))],2),e(n.Z,{staticClass:"flex-grow-1 flex-shrink-0 pa-3",staticStyle:{"background-color":"#B2C7D9"},attrs:{cols:"auto"}},[e("div",[t._l(t.messages,(function(r,i){return[e("div",[0==i?e("div",{staticClass:"admin-chat"},[e("p",[t._v(" "+t._s(r.content)+" ")])]):r.memberId?e("div",{class:{"d-flex flex-row-reverse mr-2 mt-4":r.memberId}},[e("div",{staticClass:"my-chat"},[t._v(" "+t._s(r.content)+" ")]),e("div",{staticClass:"my-chat-Time",staticStyle:{"font-size":"0.5rem"}},[t._v(" "+t._s(r.hour)+" ")])]):e("div",{class:{"d-flex mr-2 mt-6":!r.memberId}},[e(s.Z,{staticClass:"mr-2"},[e(a.Z,{attrs:{src:o(6935)(`./${r.profileImg}`),"border-radius:10px":""}})],1),e("div",[e("v-text",{staticClass:"ml-4"},[t._v(" "+t._s(r.nickname)+" ")]),e(c.Z,{staticClass:"mt-2"},[e("div",{staticClass:"target-chat"},[t._v(" "+t._s(r.content)+" ")]),e("div",{staticClass:"my-chat-Time",staticStyle:{"font-size":"0.5rem"}},[e("sub",{staticClass:"ml-1",staticStyle:{"font-size":"0.5rem"}},[t._v(" "+t._s(r.hour)+" ")])])])],1)],1)])]}))],2),e(i.ZB,{staticClass:"flex-shrink-1"},[e(l.Z,{staticClass:"messages",attrs:{filled:"",dense:"",label:"메시지를 입력해주세요",type:"text","no-details":"","hide-details":""},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.send()}},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}})],1)],1)],1)])},m=[],h=(o(57658),{name:"App",data(){return{subTitle:"",memberId:"",messages:[],message:"",roomId:"",roomList:[],hour:"",subscribeRoot:"",targetId:[],createAt:"",el:document.querySelector(".scroll"),eh:"",isScroll:""}},created(){this.memberId=this.$store.state.id,this.roomId=this.$route.query.getRoomId,this.connect(),this.getRoom(),this.sortRoom(),this.CheckIn(this.roomId)},mounted(){window.addEventListener("beforeunload",this.CheckOut(this.roomId))},beforeUnmount(){window.removeEventListener("beforeunload",this.CheckOut(this.roomId))},methods:{handler:function(t){this.CheckOut(this.roomId)},sortRoom(){this.roomList.sort((function(t,e){return t.msgTime>e.msgTime?-1:t.msgTime<e.msgTime?1:0}))},todate(){var t=new Date,e=t.getFullYear(),o=("0"+(t.getMonth()+1)).slice(-2),s=("0"+t.getDate()).slice(-2),r=("0"+t.getHours()).slice(-2),i=("0"+t.getMinutes()).slice(-2),n=("0"+t.getSeconds()).slice(-2);this.createAt=e+"-"+o+"-"+s+" "+r+":"+i+":"+n},send(){if(this.todate(),""!==this.message){const t={roomNo:this.roomId,content:this.message,memberId:this.memberId,memberIds:this.targetId,hour:this.createAt};this.axios.post("/InsertMessage/",{memberId:this.memberId,roomNo:this.roomId,content:this.message}).then((function(t){console.log(t)})).catch((function(t){console.log(t)})),this.stompClient.send("/app/send",JSON.stringify(t),(t=>{console.log(t)}))}this.message=""},CheckIn(t){console.log("checkIn test"),console.log(t),this.axios.get("/updateCheckIn",{params:{roomId:t,checkIn:1,memberId:this.memberId}}).then((function(t){console.log(t),console.log("success")})).catch((function(t){console.log(t)}))},CheckOut(t){this.axios.get("/updateCheckOut",{params:{roomId:t,memberId:this.memberId}})},CheckInOut(t,e){this.axios.get("/updateCheckInOut",{params:{preRoomId:t,currentRoomId:e,memberId:this.memberId}})},openRoom(t){var e=this;this.roomId!=t&&(this.CheckInOut(this.roomId,t),this.roomId=t),this.$store.state.stayRoomNo=t,this.messages=[],this.targetId=[],this.axios.post("/getNonReadChat",{memberId:this.memberId}).then((function(o){for(let s=0;s<e.roomList.length;s++)if(e.roomList[s].roomNo==t)e.roomList[s].nonReadChat=0,e.roomList[s].checkIn=1;else{e.roomList[s].checkIn=0;for(let t=0;t<o.data.length;t++)e.roomList[s].roomNo==o.data[t].roomNo&&(e.roomList[s].nonReadChat=o.data[t].nonReadCount,e.roomList[s].checkIn=0)}})).catch((function(t){console.log(t)})).finally((function(t){e.axios.post("/updateCheckTime",{memberId:e.memberId,roomNo:e.roomId}).then((function(t){console.log("성공")}))})),this.axios.post("/getTargetId",{roomNo:this.roomId,memberId:this.memberId}).then((function(t){console.log(t),e.targetId=t.data})).catch((function(t){console.log(t)})),e.stompClient.unsubscribe(e.$store.state.isRoomNo),this.axios.get("/getChatList/"+this.roomId,{}).then((function(t){for(let o=0;o<t.data.length;o++)e.memberId==t.data[o].memberId?t.data[o].memberId=!0:t.data[o].memberId=!1,t.data[o].hour>=12?t.data[o].hour=t.data[o].hour-12+":"+t.data[o].minute+" pm":t.data[o].hour=t.data[o].hour+":"+t.data[o].minute+" am";e.messages=t.data})).catch((function(t){console.log(t)})),e.stompClient.subscribe("/topic/room/"+t,(function(o){if(o.body==t)e.$store.state.isRoomNo=o.headers.subscription;else{let t=JSON.parse(o.body);console.log("rev : "+t),t.memberId==e.memberId?t.memberId=!0:t.memberId=!1,t.hour.substr(11,2)>=12?t.hour=t.hour.substr(11,2)-12+":"+t.hour.substr(14,2)+" pm":t.hour=t.hour.substr(11,2)+":"+t.hour.substr(14,2)+" am",e.messages.push(t)}})),this.stompClient.send("/app/getSubscribeId",e.roomId,(t=>{}))},getRoom(){var t=this;t.roomList=[],this.axios.get("/ChatRoom/"+this.memberId,{}).then((function(e){for(let o=0;o<e.data.length;o++)t.roomList.push(e.data[o])})).catch((function(t){console.log(t)})).finally((function(e){t.axios.get("/ChatMoimRoom/"+t.memberId,{}).then((function(e){for(let o=0;o<e.data.length;o++)t.roomList.push(e.data[o]);console.log(e.data)})).catch((function(t){console.log(t)})).finally((function(e){t.sortRoom(),t.openRoom(t.$route.query.getRoomId)}))}))},connect(){let t=this;t.stompClient.subscribe("/queue/"+this.$store.state.id,(function(e){if(e.body==t.$store.state.id)t.$store.state.isUser=e.headers.subscription;else{let o=JSON.parse(e.body);t.roomList.findIndex((t=>t.roomNo==o.roomNo))<0&&t.getRoom();for(let e=0;e<t.roomList.length;e++)t.roomList[e].roomNo==o.roomNo&&(t.roomList[e].content=o.content,t.roomList[e].msgTime=o.hour,t.roomId!=o.roomNo&&++t.roomList[e].nonReadChat);t.sortRoom()}})),t.stompClient.send("/app/SubscribeIds",t.$store.state.id,(t=>{console.log(t)}))},scrollDown(){let t=this.$refs.scroll,e=t.scrollHeight+200;console.log("scrol : "+e),window.scrollTo(0,e)}},watch:{messages(){this.$nextTick((()=>{console.log("nextTick TEXST"),this.scrollDown()}))}}}),u=h,g=o(1001),f=(0,g.Z)(u,d,m,!1,null,"5dde3b8f",null),p=f.exports},4245:function(){},34145:function(t,e,o){o(4245);var s=o(83434),r=o(88126),i=o(58860),n=o(67678);e["Z"]=(0,n.Z)(r.Z,i.Z,s.Z).extend({name:"v-card",props:{flat:Boolean,hover:Boolean,img:String,link:Boolean,loaderHeight:{type:[Number,String],default:4},raised:Boolean},computed:{classes(){return{"v-card":!0,...i.Z.options.computed.classes.call(this),"v-card--flat":this.flat,"v-card--hover":this.hover,"v-card--link":this.isClickable,"v-card--loading":this.loading,"v-card--disabled":this.disabled,"v-card--raised":this.raised,...s.Z.options.computed.classes.call(this)}},styles(){const t={...s.Z.options.computed.styles.call(this)};return this.img&&(t.background=`url("${this.img}") center center / cover no-repeat`),t}},methods:{genProgress(){const t=r.Z.options.methods.genProgress.call(this);return t?this.$createElement("div",{staticClass:"v-card__progress",key:"progress"},[t]):null}},render(t){const{tag:e,data:o}=this.generateRouteLink();return o.style=this.styles,this.isClickable&&(o.attrs=o.attrs||{},o.attrs.tabindex=0),t(e,this.setBackgroundColor(this.color,o),[this.genProgress(),this.$slots.default])}})},44363:function(t,e,o){o.d(e,{EB:function(){return c},Qq:function(){return n},ZB:function(){return a},h7:function(){return i}});var s=o(34145),r=o(75352);const i=(0,r.Ji)("v-card__actions"),n=(0,r.Ji)("v-card__subtitle"),a=(0,r.Ji)("v-card__text"),c=(0,r.Ji)("v-card__title");s.Z},11713:function(t,e,o){o(57658),o(1884);var s=o(20144),r=o(51767),i=o(75352);const n=["sm","md","lg","xl"],a=["start","end","center"];function c(t,e){return n.reduce(((o,s)=>(o[t+(0,i.jC)(s)]=e(),o)),{})}const l=t=>[...a,"baseline","stretch"].includes(t),d=c("align",(()=>({type:String,default:null,validator:l}))),m=t=>[...a,"space-between","space-around"].includes(t),h=c("justify",(()=>({type:String,default:null,validator:m}))),u=t=>[...a,"space-between","space-around","stretch"].includes(t),g=c("alignContent",(()=>({type:String,default:null,validator:u}))),f={align:Object.keys(d),justify:Object.keys(h),alignContent:Object.keys(g)},p={align:"align",justify:"justify",alignContent:"align-content"};function b(t,e,o){let s=p[t];if(null!=o){if(e){const o=e.replace(t,"");s+=`-${o}`}return s+=`-${o}`,s.toLowerCase()}}const I=new Map;e["Z"]=s["default"].extend({name:"v-row",functional:!0,props:{tag:{type:String,default:"div"},dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:l},...d,justify:{type:String,default:null,validator:m},...h,alignContent:{type:String,default:null,validator:u},...g},render(t,{props:e,data:o,children:s}){let i="";for(const r in e)i+=String(e[r]);let n=I.get(i);if(!n){let t;for(t in n=[],f)f[t].forEach((o=>{const s=e[o],r=b(t,o,s);r&&n.push(r)}));n.push({"no-gutters":e.noGutters,"row--dense":e.dense,[`align-${e.align}`]:e.align,[`justify-${e.justify}`]:e.justify,[`align-content-${e.alignContent}`]:e.alignContent}),I.set(i,n)}return t(e.tag,(0,r.ZP)(o,{staticClass:"row",class:n}),s)}})}}]);
//# sourceMappingURL=7942.62df9853.js.map